<?xml version="1.0" encoding="utf-8"?>
<Override>
  <Randomevents>
    <EventPrefabs>
      <!-- Event triggered from Mission -->
      <ScriptedEvent identifier="prisonertransport" commonness="100">
        <WaitAction time="2" />
        <TagAction criteria="humanprefabidentifier:prisoner" tag="prisoner" ContinueIfNoTargetsFound="false" />
        <AfflictionAction affliction="arrestedprisoner" strength="1" targettag="prisoner" />
        <WaitAction time="120" />
        <RNGAction chance="0.55">
          <Success>
            <TagAction criteria="humanprefabidentifier:prisoner" tag="briber" chooserandom="true" ChoosePercentage="1" ContinueIfNoTargetsFound="false" />
            <TagAction criteria="player" tag="player" ContinueIfNoTargetsFound="true" />
            <TriggerAction target1tag="briber" target2tag="player" applytotarget2="pt_activeplayer" radius="200" waitforinteraction="false" />
            <ConversationAction targettag="pt_activeplayer" text="eventtext.prisonertransport.prisoner.askforhelp">
              <Option text="eventtext.prisonertransport.prisoner.askforhelp.option.accept" endconversation="true">
                <EventObjectiveAction targettag="pt_activeplayer" type="add" identifier="eventtext.objective.prisonertransport.gethandcuffkey" />
                <Label name="checkforkey" />
                <CheckItemAction targettag="pt_activeplayer" itemidentifiers="handcuffkey" amount="1">
                  <Success>
                    <EventObjectiveAction targettag="pt_activeplayer" type="complete" identifier="eventtext.objective.prisonertransport.gethandcuffkey" />
                    <EventObjectiveAction targettag="pt_activeplayer" type="remove" identifier="eventtext.objective.prisonertransport.gethandcuffkey" />
                    <EventObjectiveAction targettag="pt_activeplayer" type="add" identifier="eventtext.objective.prisonertransport.unlockhandcuffs" />
                    <Label name="checkforuncuff" />
                    <NPCWaitAction npctag="briber" wait="true" />
                    <CheckAfflictionAction identifier="handcuffed" targettag="briber" minstrength="0.1">
                      <Success>
                        <WaitAction time="1" />
                        <GoTo name="checkforuncuff" />
                      </Success>
                      <Failure>
                        <EventObjectiveAction targettag="pt_activeplayer" type="completeandremove" identifier="eventtext.objective.prisonertransport.unlockhandcuffs" />
                        <AfflictionAction affliction="stun" strength="-1000" targettag="briber" />
                        <ConversationAction targettag="pt_activeplayer" text="eventtext.prisonertransport.prisoner.thanks" />
                        <MoneyAction targettag="pt_activeplayer" amount="500" />
                        <NPCWaitAction npctag="briber" wait="false" />
                        <SpawnAction itemidentifier="divingknife" targetinventory="briber" amount="1" />
                        <ClearTagAction tag="pt_activeplayer" />
                      </Failure>
                    </CheckAfflictionAction>
                  </Success>
                  <Failure>
                    <WaitAction time="1" />
                    <GoTo name="checkforkey" />
                  </Failure>
                </CheckItemAction>
              </Option>
              <Option text="eventtext.prisonertransport.prisoner.askforhelp.option.decline" endconversation="true">
                <ClearTagAction tag="pt_activeplayer" />
                <Label name="checkforinteraction" />
                <TriggerAction target1tag="briber" target2tag="player" applytotarget2="pt_activeplayer" radius="200" waitforinteraction="true" />
                <ConversationAction targettag="pt_activeplayer" text="eventtext.prisonertransport.prisoner.askforhelp">
                  <Option text="eventtext.prisonertransport.prisoner.askforhelp.option.accept" endconversation="true">
                    <EventObjectiveAction targettag="pt_activeplayer" type="add" identifier="eventtext.objective.prisonertransport.gethandcuffkey" />
                    <GoTo name="checkforkey" />
                  </Option>
                  <Option text="eventtext.prisonertransport.prisoner.askforhelp.option.decline" endconversation="true">
                    <ClearTagAction tag="pt_activeplayer" />
                    <GoTo name="checkforinteraction" />
                  </Option>
                </ConversationAction>
              </Option>
            </ConversationAction>
          </Success>
          <Failure>
            <RNGAction chance="0.50">
              <Success>
                <TagAction criteria="humanprefabidentifier:prisoner" tag="escapee" chooserandom="true" ChoosePercentage="1" ContinueIfNoTargetsFound="false" />
                <TagAction criteria="humanprefabidentifier:prisoner" tag="cuffedprisoner" chooserandom="true" ChooseRandomExcludingTag="escapee" ChoosePercentage="100" ContinueIfNoTargetsFound="false" />
                <AfflictionAction affliction="retrievehandcuffs" strength="1000" targettag="escapee" />
                <WaitAction time="1" />
                <AfflictionAction affliction="stun" strength="-1000" targettag="escapee" />
                <Label name="checkforotherprisoner" />
                <CheckConditionalAction targettag="prisoner" applytagtotarget="uncuffprisoner">
                  <Conditional arrestedprisoner="gt 0" />
                  <Success>
                    <TagAction criteria="eventtag:uncuffprisoner" tag="uncuffthis" chooserandom="true" ContinueIfNoTargetsFound="false" />
                    <NPCFollowAction NPCTag="escapee" targettag="uncuffthis" follow="true" />
                    <TriggerAction target1tag="escapee" target2tag="uncuffthis" applytotarget2="isfreed" waitforinteraction="false" radius="100" />
                    <WaitAction time="2" />
                    <AfflictionAction TargetTag="isfreed" Affliction="retrievehandcuffs" Strength="1" MultiplyByMaxVitality="true" />
                    <WaitAction time="1" />
                    <AfflictionAction TargetTag="isfreed" Affliction="stun" Strength="-100" MultiplyByMaxVitality="true" />
                    <AfflictionAction TargetTag="isfreed" Affliction="arrestedprisoner" Strength="-10000" MultiplyByMaxVitality="true" />
                    <ClearTagAction tag="uncuffprisoner" />
                    <ClearTagAction tag="uncuffthis" />
                    <ClearTagAction tag="isfreed" />
                    <GoTo name="checkforotherprisoner" />
                  </Success>
                  <Failure />
                </CheckConditionalAction>
              </Success>
              <Failure>
                <!-- Nothing happens -->
              </Failure>
            </RNGAction>
          </Failure>
        </RNGAction>
      </ScriptedEvent>
      <!-- Event triggered from handcuffs item -->
      <ScriptedEvent identifier="change_team_on_arrest">
        <!-- tag the person that just got handcuffed -->
        <TagAction criteria="eventtag:statuseffecttarget" tag="arrested" />
        <!-- tag prisoner characters from missions separately -->
        <TagAction criteria="humanprefabidentifier:prisoner" tag="skipteamchange" ContinueIfNoTargetsFound="true" />
        <!-- check if the arrested person is a prisoner from a mission by checking if they have both tags -->
        <CountTargetsAction TargetTag="arrested" SecondRequiredTargetTag="skipteamchange" minamount="1">
          <!-- if it is a mission prisoner, only apply the corresponding affliction and then skip to "remove all tags" -->
          <Success>
            <AfflictionAction TargetTag="arrested" Affliction="arrestedprisoner" Strength="1" MultiplyByMaxVitality="true" />
          </Success>
          <!-- if it is not a prisoner, proceed with the event -->
          <Failure>
            <!-- check if the person is a member of Team1 (player team) -->
            <CheckConditionalAction TargetTag="arrested">
              <Conditional teamid="Team1" />
              <Success>
                <!-- apply the corresponding affliction of their team to person to keep track of what team they were originally part of -->
                <AfflictionAction TargetTag="arrested" Affliction="arrestedteam1" Strength="1" MultiplyByMaxVitality="true" />
              </Success>
              <!-- check if the person is a member of Team2 (enemy team used in missions) -->
              <Failure>
                <CheckConditionalAction TargetTag="arrested">
                  <Conditional teamid="Team2" />
                  <Success>
                    <!-- apply the corresponding affliction of their team to person to keep track of what team they were originally part of -->
                    <AfflictionAction TargetTag="arrested" Affliction="arrestedteam2" Strength="1" MultiplyByMaxVitality="true" />
                    <!-- change their team to the player team to prevent them from disappearing when loading into another level -->
                    <NPCChangeTeamAction NPCTag="arrested" TeamID="Team1" AddToCrew="true" />
                  </Success>
                  <Failure>
                    <!-- check if the person is a member of None (enemies on abandoned stations) -->
                    <CheckConditionalAction TargetTag="arrested">
                      <Conditional teamid="None" />
                      <Success>
                        <!-- apply the corresponding affliction of their team to person to keep track of what team they were originally part of -->
                        <AfflictionAction TargetTag="arrested" Affliction="arrestednone" Strength="1" MultiplyByMaxVitality="true" />
                        <!-- change their team to the player team to prevent them from disappearing when loading into another level -->
                        <NPCChangeTeamAction NPCTag="arrested" TeamID="Team1" AddToCrew="true" />
                      </Success>
                      <Failure>
                        <!-- check if the person is a member of FriendlyNPC (characters on faction owned outposts) and does not belong to the bandits faction from DynamicEuropa -->
                        <!-- this is done to differentiate between arresting on a regular outpost and a pirate outpost -->
                        <!-- arresting a pirate on a pirate outpost will alert all pirates on the outpost if the player was seen, but arresting non-pirate characters will be ignored -->
                        <!-- pirates arrested on pirate outposts will not count as friendly NPC arrests so they can't be sold as hostages back to themselves -->
                        <CheckConditionalAction TargetTag="arrested" LogicalOperator="And">
                          <Conditional teamid="FriendlyNPC" />
                          <Conditional faction="neq bandits" />
                          <!-- friendly outpost related actions -->
                          <Success>
                            <!-- tag all players currently on the outpost -->
                            <TagAction criteria="player" tag="player" submarinetype="Outpost" />
                            <!-- mark the handcuffed person to be ignored from the witness visibility check -->
                            <CheckConditionalAction TargetTag="arrested" applytagtotarget="ignorelineofsight">
                              <Conditional IsBot="true" />
                              <Success />
                              <Failure />
                            </CheckConditionalAction>
                            <!-- tag the player currently within 1.5m of the handcuffed person (we assume here that this would be the player who handcuffed the person) -->
                            <TriggerAction target1tag="arrested" target2tag="player" applytotarget2="arrestingplayer" waitforinteraction="false" radius="150" />
                            <!-- tag all bots currently on the outpost -->
                            <TagAction criteria="bot" tag="checkifinhabitant" submarinetype="Outpost" />
                            <!-- mark all pirates to be ignored from the witness visibility check -->
                            <CheckConditionalAction TargetTag="checkifinhabitant" applytagtotarget="ignorelineofsight">
                              <Conditional faction="bandits" />
                              <Success />
                              <Failure />
                            </CheckConditionalAction>
                            <!-- check all tagged bots for their team. If they're part of FriendlyNPC team, apply a tag to them to mark them as potential witnesses-->
                            <CheckConditionalAction TargetTag="checkifinhabitant" applytagtotarget="potentialwitness">
                              <Conditional teamid="FriendlyNPC" />
                              <Success>
                                <!-- check if a potential witness can see how the player handcuffed the person (but exclude the handcuffed person and all pirates from the check) -->
                                <CheckVisibilityAction EntityTag="potentialwitness" ExcludedEntityTag="ignorelineofsight" TargetTag="arrestingplayer" ApplyTagToTarget="securityarresttarget">
                                  <Success>
                                    <!-- reduce reputation for the location if the player has been seen handcuffing the person -->
                                    <ReputationAction targettype="Location" increase="-10" />
                                    <!-- make security guards run to the person you handcuffed -->
                                    <NPCFollowAction NPCTag="securitynpc" targettag="arrested" follow="true" />
                                    <!-- check if a security guard is within 1m of the handcuffed person to apply a tag to the handcuffed person -->
                                    <TriggerAction target1tag="securitynpc" target2tag="arrested" applytotarget2="uncuffed" waitforinteraction="false" radius="100" />
                                    <!-- apply the affliction that removes the handcuffs to free the handcuffed person -->
                                    <StatusEffectAction targettag="uncuffed">
                                      <StatusEffect target="This" disabledeltatime="true">
                                        <Affliction identifier="retrievehandcuffs" amount="1" />
                                      </StatusEffect>
                                    </StatusEffectAction>
                                    <!-- now make the guards try to arrest the player who handcuffed the person -->
                                    <CombatAction CombatMode="Arrest" WitnessReaction="Retreat" NPCTag="securitynpc" EnemyTag="securityarresttarget" />
                                  </Success>
                                  <Failure>
                                    <!-- if the player was not spotted handcuffing the person, apply the corresponding affliction of the person's team to keep track of what team they were originally part of -->
                                    <AfflictionAction TargetTag="arrested" Affliction="arrestedfriendly" Strength="1" MultiplyByMaxVitality="true" />
                                    <!-- change their team to the player team to prevent them from disappearing when loading into another level -->
                                    <NPCChangeTeamAction NPCTag="arrested" TeamID="Team1" AddToCrew="true" />
                                  </Failure>
                                </CheckVisibilityAction>
                              </Success>
                            </CheckConditionalAction>
                          </Success>
                          <!-- pirate outpost related actions -->
                          <Failure>
                            <!-- tag all players currently on the outpost -->
                            <TagAction criteria="player" tag="player" submarinetype="Outpost" />
                            <!-- tag the player currently within 1.5m of the handcuffed pirate (we assume here that this would be the player who handcuffed the person) -->
                            <TriggerAction target1tag="arrested" target2tag="player" applytotarget2="arrestingplayer" waitforinteraction="false" radius="150" />
                            <!-- tag all bots currently on the outpost -->
                            <TagAction criteria="bot" tag="checkifinhabitant" submarinetype="Outpost" />
                            <!-- check all tagged bots for their team. If they're part of FriendlyNPC team, apply a tag to them to mark them as potential witnesses-->
                            <CheckConditionalAction TargetTag="checkifinhabitant" applytagtotarget="potentialwitness">
                              <Conditional teamid="FriendlyNPC" />
                              <Success>
                                <!-- check if a potential witness can see how the player handcuffed the pirate (but exclude the handcuffed person from the check) -->
                                <CheckVisibilityAction EntityTag="potentialwitness" ExcludedEntityTag="arrested" TargetTag="arrestingplayer" ApplyTagToTarget="securityarresttarget">
                                  <Success>
                                    <!-- reduce reputation for the location if the player has been seen handcuffing the person -->
                                    <ReputationAction targettype="Location" increase="-10" />
                                    <!-- make other pirates run to the pirate you handcuffed -->
                                    <NPCFollowAction NPCTag="piratenpc" targettag="arrested" follow="true" />
                                    <!-- check if a pirate is within 1m of the handcuffed pirate to apply a tag to the handcuffed pirate -->
                                    <TriggerAction target1tag="piratenpc" target2tag="arrested" applytotarget2="uncuffed" waitforinteraction="false" radius="100" />
                                    <!-- apply the affliction that removes the handcuffs to free the handcuffed pirate -->
                                    <StatusEffectAction targettag="uncuffed">
                                      <StatusEffect target="This" disabledeltatime="true">
                                        <Affliction identifier="retrievehandcuffs" amount="1" />
                                      </StatusEffect>
                                    </StatusEffectAction>
                                    <!-- now make all the other pirates try to arrest the player who handcuffed the pirate -->
                                    <CombatAction CombatMode="Arrest" WitnessReaction="Retreat" NPCTag="piratenpc" EnemyTag="securityarresttarget" />
                                  </Success>
                                  <Failure>
                                    <!-- if the player was not spotted handcuffing the pirate, apply the corresponding affliction of Team2 to keep make the pirate hostile when uncuffing -->
                                    <AfflictionAction TargetTag="arrested" Affliction="arrestedteam2" Strength="1" MultiplyByMaxVitality="true" />
                                    <!-- change their team to the player team to prevent them from disappearing when loading into another level -->
                                    <NPCChangeTeamAction NPCTag="arrested" TeamID="Team1" AddToCrew="true" />
                                  </Failure>
                                </CheckVisibilityAction>
                              </Success>
                            </CheckConditionalAction>
                          </Failure>
                        </CheckConditionalAction>
                      </Failure>
                    </CheckConditionalAction>
                  </Failure>
                </CheckConditionalAction>
              </Failure>
            </CheckConditionalAction>
          </Failure>
        </CountTargetsAction>
        <!-- remove all the event tags -->
        <ClearTagAction tag="arrested" />
        <ClearTagAction tag="player" />
        <ClearTagAction tag="bot" />
        <ClearTagAction tag="enemy" />
        <ClearTagAction tag="checkifinhabitant" />
        <ClearTagAction tag="potentialwitness" />
        <ClearTagAction tag="ignorelineofsight" />
        <ClearTagAction tag="arrestingplayer" />
        <ClearTagAction tag="securityarresttarget" />
        <ClearTagAction tag="uncuffed" />
        <ClearTagAction tag="skipteamchange" />
      </ScriptedEvent>
      <!-- Event triggered from handcuff key item -->
      <ScriptedEvent identifier="change_team_on_released">
        <TagAction criteria="eventtag:statuseffecttarget" tag="released" />
        <CheckConditionalAction TargetTag="released">
          <Conditional arrestedteam1="gt 0" />
          <Success>
            <NPCChangeTeamAction NPCTag="released" TeamID="Team1" AddToCrew="true" RemoveFromCrew="false" />
          </Success>
          <Failure>
            <CheckConditionalAction TargetTag="released">
              <Conditional arrestedteam2="gt 0" />
              <Success>
                <NPCChangeTeamAction NPCTag="released" TeamID="Team2" AddToCrew="false" RemoveFromCrew="true" />
              </Success>
              <Failure>
                <CheckConditionalAction TargetTag="released">
                  <Conditional arrestednone="gt 0" />
                  <Success>
                    <NPCChangeTeamAction NPCTag="released" TeamID="None" AddToCrew="false" RemoveFromCrew="true" />
                  </Success>
                  <Failure>
                    <CheckConditionalAction TargetTag="released">
                      <Conditional arrestedfriendly="gt 0" />
                      <Success>
                        <NPCChangeTeamAction NPCTag="released" TeamID="FriendlyNPC" AddToCrew="false" RemoveFromCrew="true" />
                      </Success>
                      <Failure />
                    </CheckConditionalAction>
                  </Failure>
                </CheckConditionalAction>
              </Failure>
            </CheckConditionalAction>
          </Failure>
        </CheckConditionalAction>
        <StatusEffectAction TargetTag="released">
          <StatusEffect target="This" disabledeltatime="true" multiplyafflictionsbymaxvitality="true">
            <ReduceAffliction identifier="arrestedteam1" amount="10000" />
            <ReduceAffliction identifier="arrestedteam2" amount="10000" />
            <ReduceAffliction identifier="arrestednone" amount="10000" />
            <ReduceAffliction identifier="arrestedfriendly" amount="10000" />
            <ReduceAffliction identifier="arrestedprisoner" amount="10000" />
          </StatusEffect>
        </StatusEffectAction>
        <ClearTagAction tag="released" />
      </ScriptedEvent>
      <!-- Event triggered from EventSet -->
      <ScriptedEvent identifier="collectarrestedbounty_coalition">
        <TagAction criteria="bot" tag="bot" />
        <TagAction criteria="player" tag="player" />
        <SpawnAction npcsetidentifier="ih_npcs" npcidentifier="bountycollectorcoalition" lootingisstealing="true" targettag="bountycollector" spawnlocation="Outpost" spawnpointtype="Path" teamid="FriendlyNPC" allowduplicates="false" targetmoduletags="AdminModule" />
        <WaitAction time="1" />
        <CheckItemAction targettag="bountycollector" itemidentifiers="idcard" ApplyTagToItem="bountycollectorid" />
        <WaitAction time="1" />
        <StatusEffectAction targettag="bountycollectorid">
          <StatusEffect target="this" SubmarineSpecificID="0" NonPlayerTeamInteractable="true" setvalue="true" />
        </StatusEffectAction>
        <TriggerAction target1tag="bountycollector" target2tag="player" applytotarget2="bountyplayer" waitforinteraction="false" radius="150" />
        <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.introduction" DialogType="Small" ignoreinterruptdistance="true" EventSprite="infiltration1" />
        <Label name="restart" />
        <ClearTagAction tag="bountyplayer" />
        <TriggerAction target1tag="bountycollector" target2tag="player" applytotarget2="bountyplayer" waitforinteraction="true" radius="300" />
        <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested" DialogType="Small" ignoreinterruptdistance="true" EventSprite="infiltration1">
          <Option text="eventtext.bountycollector.askforarrested.option.yes">
            <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested.option.yes.reply" DialogType="Small" ignoreinterruptdistance="true" EventSprite="infiltration1" />
            <Label name="checkforarrested" />
            <NPCFollowAction NPCTag="isarrested" targettag="bountycollector" follow="true" />
            <ClearTagAction tag="arrestbounty" />
            <CheckConditionalAction targettag="bot" applytagtotarget="collectbounty">
              <Conditional arrestednone="gt 0" />
              <Conditional arrestedteam2="gt 0" />
              <Success>
                <TagAction criteria="eventtag:collectbounty" tag="bountycollected" chooserandomexcludingtag="bountycollected" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <TagAction criteria="eventtag:bountycollected" tag="arrestbounty" chooserandomexcludingtag="isarrested" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <NPCFollowAction NPCTag="bountycollector" targettag="arrestbounty" follow="true" />
                <TriggerAction target1tag="bountycollector" target2tag="arrestbounty" applytotarget2="isarrested" waitforinteraction="false" radius="100" />
                <CheckItemAction targettag="arrestbounty" itemtags="clothing" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="smallitem" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="mediumitem" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="weapon" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="gun" ApplyTagToItem="removeitem" />
                <StatusEffectAction targettag="removeitem">
                  <StatusEffect target="This">
                    <Remove />
                  </StatusEffect>
                </StatusEffectAction>
                <StatusEffectAction targettag="arrestbounty">
                  <StatusEffect target="This" disabledeltatime="true">
                    <SpawnItem identifier="prisonerclothes" spawnposition="ThisInventory" equip="true" />
                  </StatusEffect>
                </StatusEffectAction>
                <NPCChangeTeamAction NPCTag="arrestbounty" TeamID="FriendlyNPC" AddToCrew="false" RemoveFromCrew="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="arrestednone" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="arrestedteam2" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="handcuffed" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="handcuffedreinforced" Strength="-10000" MultiplyByMaxVitality="true" />
                <StatusEffectAction targettag="arrestbounty">
                  <StatusEffect target="this">
                    <SpawnItem identifier="idcard" spawnposition="ThisInventory" equip="true" />
                  </StatusEffect>
                </StatusEffectAction>
                <CheckItemAction targettag="arrestbounty" itemidentifier="idcard" ApplyTagToItem="arrestedid" />
                <StatusEffectAction targettag="arrestedid">
                  <StatusEffect target="this" tags="id_captain" SubmarineSpecificID="0" NonPlayerTeamInteractable="true" setvalue="true" />
                </StatusEffectAction>
                <MoneyAction amount="750" />
                <TagAction criteria="eventtag:arrestbounty" tag="completed" chooserandomexcludingtag="completed" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <WaitAction time="2" />
                <GoTo name="checkforarrested" />
              </Success>
              <Failure>
                <CountTargetsAction targettag="completed" minamount="1">
                  <Success>
                    <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.finished" DialogType="Small" ignoreinterruptdistance="true" EventSprite="infiltration1" />
                    <NPCFollowAction NPCTag="isarrested" targettag="bountycollector" follow="true" abandononreset="false" />
                    <ClearTagAction tag="bountyplayer" />
                    <ClearTagAction tag="completed" />
                    <GoTo name="restart" />
                  </Success>
                  <Failure>
                    <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested.option.yes.reply.noarrested" DialogType="Small" ignoreinterruptdistance="true" EventSprite="infiltration1" />
                    <GoTo name="restart" />
                  </Failure>
                </CountTargetsAction>
              </Failure>
            </CheckConditionalAction>
          </Option>
          <Option text="eventtext.bountycollector.askforarrested.option.no">
            <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested.option.no.reply" DialogType="Small" ignoreinterruptdistance="true" EventSprite="infiltration1" />
            <GoTo name="restart" />
          </Option>
        </ConversationAction>
      </ScriptedEvent>
      <!-- Event triggered from EventSet -->
      <ScriptedEvent identifier="collectarrestedbounty_separatists">
        <TagAction criteria="bot" tag="bot" />
        <TagAction criteria="player" tag="player" />
        <SpawnAction npcsetidentifier="ih_npcs" npcidentifier="bountycollectorseparatists" lootingisstealing="true" targettag="bountycollector" spawnlocation="Outpost" spawnpointtype="Path" teamid="FriendlyNPC" allowduplicates="false" targetmoduletags="AdminModule" />
        <WaitAction time="1" />
        <CheckItemAction targettag="bountycollector" itemidentifiers="idcard" ApplyTagToItem="bountycollectorid" />
        <WaitAction time="1" />
        <StatusEffectAction targettag="bountycollectorid">
          <StatusEffect target="this" SubmarineSpecificID="0" NonPlayerTeamInteractable="true" setvalue="true" />
        </StatusEffectAction>
        <TriggerAction target1tag="bountycollector" target2tag="player" applytotarget2="bountyplayer" waitforinteraction="false" radius="150" />
        <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.introduction" DialogType="Small" ignoreinterruptdistance="true" EventSprite="stuckinthemiddle1" />
        <Label name="restart" />
        <ClearTagAction tag="bountyplayer" />
        <TriggerAction target1tag="bountycollector" target2tag="player" applytotarget2="bountyplayer" waitforinteraction="true" radius="300" />
        <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested" DialogType="Small" ignoreinterruptdistance="true" EventSprite="stuckinthemiddle1">
          <Option text="eventtext.bountycollector.askforarrested.option.yes">
            <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested.option.yes.reply" DialogType="Small" ignoreinterruptdistance="true" EventSprite="stuckinthemiddle1" />
            <Label name="checkforarrested" />
            <NPCFollowAction NPCTag="isarrested" targettag="bountycollector" follow="true" />
            <ClearTagAction tag="arrestbounty" />
            <CheckConditionalAction targettag="bot" applytagtotarget="collectbounty">
              <Conditional arrestednone="gt 0" />
              <Conditional arrestedteam2="gt 0" />
              <Success>
                <TagAction criteria="eventtag:collectbounty" tag="bountycollected" chooserandomexcludingtag="bountycollected" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <TagAction criteria="eventtag:bountycollected" tag="arrestbounty" chooserandomexcludingtag="isarrested" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <NPCFollowAction NPCTag="bountycollector" targettag="arrestbounty" follow="true" />
                <TriggerAction target1tag="bountycollector" target2tag="arrestbounty" applytotarget2="isarrested" waitforinteraction="false" radius="100" />
                <CheckItemAction targettag="arrestbounty" itemtags="clothing" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="smallitem" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="mediumitem" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="weapon" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="gun" ApplyTagToItem="removeitem" />
                <StatusEffectAction targettag="removeitem">
                  <StatusEffect target="This">
                    <Remove />
                  </StatusEffect>
                </StatusEffectAction>
                <StatusEffectAction targettag="arrestbounty">
                  <StatusEffect target="This" disabledeltatime="true">
                    <SpawnItem identifier="prisonerclothes" spawnposition="ThisInventory" equip="true" />
                  </StatusEffect>
                </StatusEffectAction>
                <NPCChangeTeamAction NPCTag="arrestbounty" TeamID="FriendlyNPC" AddToCrew="false" RemoveFromCrew="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="arrestednone" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="arrestedteam2" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="handcuffed" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="handcuffedreinforced" Strength="-10000" MultiplyByMaxVitality="true" />
                <StatusEffectAction targettag="arrestbounty">
                  <StatusEffect target="this">
                    <SpawnItem identifier="idcard" spawnposition="ThisInventory" equip="true" />
                  </StatusEffect>
                </StatusEffectAction>
                <CheckItemAction targettag="arrestbounty" itemidentifier="idcard" ApplyTagToItem="arrestedid" />
                <StatusEffectAction targettag="arrestedid">
                  <StatusEffect target="this" tags="id_captain" SubmarineSpecificID="0" NonPlayerTeamInteractable="true" setvalue="true" />
                </StatusEffectAction>
                <MoneyAction amount="750" />
                <TagAction criteria="eventtag:arrestbounty" tag="completed" chooserandomexcludingtag="completed" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <WaitAction time="2" />
                <GoTo name="checkforarrested" />
              </Success>
              <Failure>
                <CountTargetsAction targettag="completed" minamount="1">
                  <Success>
                    <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.finished" DialogType="Small" ignoreinterruptdistance="true" EventSprite="stuckinthemiddle1" />
                    <NPCFollowAction NPCTag="isarrested" targettag="bountycollector" follow="true" abandononreset="false" />
                    <ClearTagAction tag="bountyplayer" />
                    <ClearTagAction tag="completed" />
                    <GoTo name="restart" />
                  </Success>
                  <Failure>
                    <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested.option.yes.reply.noarrested" DialogType="Small" ignoreinterruptdistance="true" EventSprite="stuckinthemiddle1" />
                    <GoTo name="restart" />
                  </Failure>
                </CountTargetsAction>
              </Failure>
            </CheckConditionalAction>
          </Option>
          <Option text="eventtext.bountycollector.askforarrested.option.no">
            <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested.option.no.reply" DialogType="Small" ignoreinterruptdistance="true" EventSprite="stuckinthemiddle1" />
            <GoTo name="restart" />
          </Option>
        </ConversationAction>
      </ScriptedEvent>
      <!-- Event triggered from EventSet -->
      <ScriptedEvent identifier="collectarrestedbounty_pirates">
        <TagAction criteria="bot" tag="bot" />
        <TagAction criteria="player" tag="player" />
        <SpawnAction npcsetidentifier="ih_npcs" npcidentifier="bountycollectorpirates" lootingisstealing="true" targettag="bountycollector" spawnlocation="Outpost" spawnpointtype="Path" teamid="FriendlyNPC" allowduplicates="false" targetmoduletags="AdminModule" />
        <WaitAction time="1" />
        <CheckItemAction targettag="bountycollector" itemidentifiers="idcard" ApplyTagToItem="bountycollectorid" />
        <WaitAction time="1" />
        <StatusEffectAction targettag="bountycollectorid">
          <StatusEffect target="this" SubmarineSpecificID="0" NonPlayerTeamInteractable="true" setvalue="true" />
        </StatusEffectAction>
        <TriggerAction target1tag="bountycollector" target2tag="player" applytotarget2="bountyplayer" waitforinteraction="false" radius="150" />
        <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.pirate.introduction" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
        <Label name="restart" />
        <ClearTagAction tag="bountyplayer" />
        <TriggerAction target1tag="bountycollector" target2tag="player" applytotarget2="bountyplayer" waitforinteraction="true" radius="300" />
        <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.pirate.askforarrested" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1">
          <Option text="eventtext.bountycollector.askforarrested.option.yes">
            <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.pirate.askforarrested.option.yes.reply" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
            <Label name="checkforarrested" />
            <NPCFollowAction NPCTag="isarrested" targettag="bountycollector" follow="true" />
            <ClearTagAction tag="arrestbounty" />
            <CheckConditionalAction targettag="bot" applytagtotarget="collectbounty">
              <Conditional arrestedfriendly="gt 0" />
              <Success>
                <TagAction criteria="eventtag:collectbounty" tag="bountycollected" chooserandomexcludingtag="bountycollected" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <TagAction criteria="eventtag:bountycollected" tag="arrestbounty" chooserandomexcludingtag="isarrested" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <NPCFollowAction NPCTag="bountycollector" targettag="arrestbounty" follow="true" />
                <TriggerAction target1tag="bountycollector" target2tag="arrestbounty" applytotarget2="isarrested" waitforinteraction="false" radius="100" />
                <CheckItemAction targettag="arrestbounty" itemtags="clothing" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="smallitem" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="mediumitem" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="weapon" ApplyTagToItem="removeitem" />
                <CheckItemAction targettag="arrestbounty" itemtags="gun" ApplyTagToItem="removeitem" />
                <StatusEffectAction targettag="removeitem">
                  <StatusEffect target="This">
                    <Remove />
                  </StatusEffect>
                </StatusEffectAction>
                <StatusEffectAction targettag="arrestbounty">
                  <StatusEffect target="This" disabledeltatime="true">
                    <SpawnItem identifier="prisonerclothes" spawnposition="ThisInventory" equip="true" />
                  </StatusEffect>
                </StatusEffectAction>
                <NPCChangeTeamAction NPCTag="arrestbounty" TeamID="FriendlyNPC" AddToCrew="false" RemoveFromCrew="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="arrestedfriendly" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="handcuffed" Strength="-10000" MultiplyByMaxVitality="true" />
                <AfflictionAction TargetTag="arrestbounty" Affliction="handcuffedreinforced" Strength="-10000" MultiplyByMaxVitality="true" />
                <StatusEffectAction targettag="arrestbounty">
                  <StatusEffect target="this">
                    <SpawnItem identifier="idcard" spawnposition="ThisInventory" equip="true" />
                  </StatusEffect>
                </StatusEffectAction>
                <CheckItemAction targettag="arrestbounty" itemidentifier="idcard" ApplyTagToItem="arrestedid" />
                <StatusEffectAction targettag="arrestedid">
                  <StatusEffect target="this" tags="id_captain" SubmarineSpecificID="0" NonPlayerTeamInteractable="true" setvalue="true" />
                </StatusEffectAction>
                <MoneyAction amount="500" />
                <ReputationAction targettype="Location" increase="2" />
                <TagAction criteria="eventtag:arrestbounty" tag="completed" chooserandomexcludingtag="completed" chooserandom="true" ContinueIfNoTargetsFound="true" />
                <WaitAction time="2" />
                <GoTo name="checkforarrested" />
              </Success>
              <Failure>
                <CountTargetsAction targettag="completed" minamount="1">
                  <Success>
                    <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.finished" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
                    <NPCFollowAction NPCTag="isarrested" targettag="bountycollector" follow="true" abandononreset="false" />
                    <ClearTagAction tag="bountyplayer" />
                    <ClearTagAction tag="completed" />
                    <GoTo name="restart" />
                  </Success>
                  <Failure>
                    <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.pirate.askforarrested.option.yes.reply.noarrested" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
                    <GoTo name="restart" />
                  </Failure>
                </CountTargetsAction>
              </Failure>
            </CheckConditionalAction>
          </Option>
          <Option text="eventtext.bountycollector.askforarrested.option.no">
            <ConversationAction targettag="bountyplayer" speakertag="bountycollector" waitforinteraction="false" text="eventtext.bountycollector.askforarrested.option.no.reply" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
            <GoTo name="restart" />
          </Option>
        </ConversationAction>
      </ScriptedEvent>
      <!-- Event triggered from handcuffs item used by security when player gets arrested -->
      <ScriptedEvent identifier="send_to_jail">
        <TagAction criteria="eventtag:statuseffecttarget" tag="teleport" ContinueIfNoTargetsFound="true" />
        <TagAction criteria="itemtag:securityalarm" tag="jailcell" ContinueIfNoTargetsFound="true" />
        <TagAction criteria="itemtag:door" tag="jaildoor" RequiredModuleTag="Securitymodule" ContinueIfNoTargetsFound="true" />
        <CountTargetsAction targettag="jailcell" minamount="1">
          <Success>
            <StatusEffectAction targettag="jaildoor">
              <StatusEffect target="This" IsOpen="false" disabledeltatime="true" setvalue="true" />
            </StatusEffectAction>
            <StatusEffectAction targettag="teleport">
              <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
                <Affliction identifier="blackscreen" amount="100" />
              </StatusEffect>
            </StatusEffectAction>
            <WaitAction time="0.5" />
            <TeleportAction position="Outpost" SpawnType="Corpse" SpawnPointTag="jail" targettag="teleport" />
            <StatusEffectAction targettag="teleport">
              <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
                <Affliction identifier="jailtime" amount="300" />
                <Affliction identifier="playsound_lockjail" amount="100" />
                <Affliction identifier="playsound_handcuff" amount="100" />
                <ReduceAffliction identifier="handcuffed" amount="1000" />
                <ReduceAffliction identifier="handcuffedreinforced" amount="1000" />
              </StatusEffect>
            </StatusEffectAction>
            <!-- check for the equipped handcuffs and mark them for deletion -->
            <CheckItemAction targettag="teleport" itemtags="handcuffs" ApplyTagToItem="removeitem" />
            <!-- delete the equipped handcuffs -->
            <StatusEffectAction targettag="removeitem">
              <StatusEffect target="This" disabledeltatime="true">
                <Remove />
              </StatusEffect>
            </StatusEffectAction>
          </Success>
          <Failure>
            <StatusEffectAction targettag="teleport">
              <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
                <Affliction identifier="blackscreen" amount="100" />
              </StatusEffect>
            </StatusEffectAction>
            <WaitAction time="0.5" />
            <TeleportAction position="MainSub" SpawnType="Human" targettag="teleport" />
            <StatusEffectAction targettag="teleport">
              <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
                <Affliction identifier="bannedtime" amount="300" />
                <Affliction identifier="playsound_lockjail" amount="100" />
                <Affliction identifier="playsound_handcuff" amount="100" />
                <ReduceAffliction identifier="handcuffed" amount="1000" />
                <ReduceAffliction identifier="handcuffedreinforced" amount="1000" />
              </StatusEffect>
            </StatusEffectAction>
            <!-- check for the equipped handcuffs and mark them for deletion -->
            <CheckItemAction targettag="teleport" itemtags="handcuffs" ApplyTagToItem="removeitem" />
            <!-- delete the equipped handcuffs -->
            <StatusEffectAction targettag="removeitem">
              <StatusEffect target="This" disabledeltatime="true">
                <Remove />
              </StatusEffect>
            </StatusEffectAction>
            <ReputationAction targettype="Location" increase="-5" />
          </Failure>
        </CountTargetsAction>
        <ClearTagAction tag="jailcell" />
        <ClearTagAction tag="jaildoor" />
        <ClearTagAction tag="isarrested" />
        <ClearTagAction tag="imprison" />
      </ScriptedEvent>
      <!-- Event triggered from whistle item -->
      <ScriptedEvent identifier="send_to_brig">
        <TagAction criteria="eventtag:statuseffecttarget" tag="teleport" submarinetype="Player" ContinueIfNoTargetsFound="true" />
        <StatusEffectAction targettag="teleport">
          <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
            <Affliction identifier="blackscreen" amount="100" />
          </StatusEffect>
        </StatusEffectAction>
        <WaitAction time="0.5" />
        <TeleportAction position="MainSub" SpawnType="Human" SpawnPointTag="brig" targettag="teleport" />
        <StatusEffectAction targettag="teleport">
          <StatusEffect target="This" disabledeltatime="true">
            <Affliction identifier="playsound_lockjail" amount="100" />
            <Affliction identifier="playsound_handcuff" amount="100" />
          </StatusEffect>
        </StatusEffectAction>
        <ClearTagAction tag="teleport" />
        <ClearTagAction tag="imprison" />
      </ScriptedEvent>
      <!-- Event triggered from EventSet on every round start to spawn inmates back into the brig -->
      <ScriptedEvent identifier="imprisoned_to_brig">
        <WaitAction time="1" />
        <TagAction criteria="player" tag="checkifinmate" />
        <TagAction criteria="bot" tag="checkifinmate" />
        <CheckConditionalAction targettag="checkifinmate" applytagtotarget="isinmate">
          <Conditional imprisonedbrig="gt 0" />
          <Success>
            <TeleportAction position="MainSub" SpawnType="Human" SpawnPointTag="brig" targettag="isinmate" />
          </Success>
          <Failure />
        </CheckConditionalAction>
        <ClearTagAction tag="checkifinmate" />
        <ClearTagAction tag="isinmate" />
      </ScriptedEvent>
      <!-- Event triggered from EventSet in every round | needs to always run -->
      <ScriptedEvent identifier="check_if_still_imprisoned">
        <TagAction criteria="hullname:brig" tag="brig" submarinetype="Player" ContinueIfNoTargetsFound="true" />
        <TagAction criteria="hull" tag="jailcellhull" submarinetype="Outpost" RequiredModuleTag="Securitymodule" ContinueIfNoTargetsFound="true" />
        <Label name="repeat" />
        <!-- apply imprisoned_brig affliction to all characters within the brig to teleport them back into the brig at the start of next round -->
        <!-- the affliction removes itself after 2 seconds if the character stays out of the brig to dynamically determine if the person escaped or was released -->
        <StatusEffectAction targettag="brig">
          <StatusEffect target="This,NearbyCharacters" range="100" disabledeltatime="true">
            <Affliction identifier="imprisonedbrig" amount="10" />
          </StatusEffect>
        </StatusEffectAction>
        <CountTargetsAction targettag="jailcellhull" minamount="1">
          <Success>
            <StatusEffectAction targettag="jailcellhull">
              <StatusEffect target="This,NearbyCharacters" range="100" disabledeltatime="true">
                <Affliction identifier="imprisonedjail" amount="1" />
              </StatusEffect>
            </StatusEffectAction>
          </Success>
        </CountTargetsAction>
        <WaitAction time="1" />
        <GoTo name="repeat" />
      </ScriptedEvent>
      <!-- Event triggered from EventSet in every outpost round at specific locations -->
      <ScriptedEvent identifier="check_for_prison_escapee">
        <TagAction criteria="player" tag="potentialescapee" />
        <TagAction criteria="bot" tag="potentialescapee" />
        <Label name="recheck" />
        <CheckConditionalAction targettag="potentialescapee" applytagtotarget="escapee" LogicalOperator="And">
          <Conditional jailtime="gt 0" />
          <Conditional imprisonedjail="lte 0" />
          <Success>
            <CheckVisibilityAction EntityTag="securitynpc" TargetTag="escapee" ApplyTagToTarget="securityarresttarget" CheckFacing="true">
              <Success>
                <CheckConditionalAction targettag="escapee">
                  <Conditional handcuffed="gt 0" />
                  <Success>
                    <CombatAction CombatMode="Arrest" WitnessReaction="Retreat" NPCTag="securitynpc" EnemyTag="securityarresttarget" />
                    <TriggerAction target1tag="securitynpc" target2tag="escapee" radius="75" waitforinteraction="false" allowmultipletargets="true" checkalltargets="false" disableincombat="false" disableiftargetincapacitated="false" />
                    <WaitAction time="1" />
                    <CheckConditionalAction targettag="escapee">
                      <Conditional stun="gt 0" />
                      <Success>
                        <StatusEffectAction targettag="escapee">
                          <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
                            <Affliction identifier="blackscreen" amount="100" />
                          </StatusEffect>
                        </StatusEffectAction>
                        <WaitAction time="0.5" />
                        <TeleportAction position="Outpost" SpawnType="Corpse" SpawnPointTag="jail" targettag="escapee" />
                        <StatusEffectAction targettag="escapee">
                          <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
                            <Affliction identifier="jailtime" amount="300" />
                            <Affliction identifier="playsound_lockjail" amount="100" />
                            <Affliction identifier="playsound_handcuff" amount="100" />
                          </StatusEffect>
                        </StatusEffectAction>
                        <ClearTagAction tag="escapee" />
                        <ClearTagAction tag="securityarresttarget" />
                        <WaitAction time="1" />
                        <GoTo name="recheck" />
                      </Success>
                      <Failure>
                        <ClearTagAction tag="escapee" />
                        <ClearTagAction tag="securityarresttarget" />
                        <WaitAction time="1" />
                        <GoTo name="recheck" />
                      </Failure>
                    </CheckConditionalAction>
                  </Success>
                  <Failure>
                    <CombatAction CombatMode="Arrest" WitnessReaction="Retreat" NPCTag="securitynpc" EnemyTag="securityarresttarget" />
                    <WaitAction time="30" />
                    <ClearTagAction tag="escapee" />
                    <ClearTagAction tag="securityarresttarget" />
                    <GoTo name="recheck" />
                  </Failure>
                </CheckConditionalAction>
              </Success>
              <Failure>
                <ClearTagAction tag="escapee" />
                <WaitAction time="1" />
                <GoTo name="recheck" />
              </Failure>
            </CheckVisibilityAction>
          </Success>
          <Failure>
            <WaitAction time="1" />
            <GoTo name="recheck" />
          </Failure>
        </CheckConditionalAction>
      </ScriptedEvent>
      <!-- Event triggered from EventSet in every outpost round at all locations -->
      <ScriptedEvent identifier="check_for_trespasser">
        <TagAction criteria="player" tag="potentialtrespasser" />
        <TagAction criteria="bot" tag="potentialtrespasser" />
        <Label name="recheck" />
        <CheckConditionalAction targettag="potentialtrespasser" applytagtotarget="trespasser" LogicalOperator="And">
          <Conditional bannedtime="gt 0" />
          <Success>
            <CheckVisibilityAction EntityTag="securitynpc" TargetTag="trespasser" ApplyTagToTarget="securityarresttarget" CheckFacing="true">
              <Success>
                <CombatAction CombatMode="Arrest" WitnessReaction="Retreat" NPCTag="securitynpc" EnemyTag="securityarresttarget" />
                <WaitAction time="30" />
                <ClearTagAction tag="trespasser" />
                <ClearTagAction tag="securityarresttarget" />
                <GoTo name="recheck" />
              </Success>
              <Failure>
                <ClearTagAction tag="trespasser" />
                <WaitAction time="1" />
                <GoTo name="recheck" />
              </Failure>
            </CheckVisibilityAction>
          </Success>
          <Failure>
            <WaitAction time="1" />
            <GoTo name="recheck" />
          </Failure>
        </CheckConditionalAction>
      </ScriptedEvent>
      <ScriptedEvent identifier="check_for_skipped_arrest">
        <TagAction criteria="player" tag="checkarrest" />
        <TagAction criteria="bot" tag="checkarrest" />
        <OnRoundEndAction>
          <CheckConditionalAction targettag="checkarrest">
            <Conditional jailtime="gt 0" />
            <Success>
              <ReputationAction targettype="Location" increase="-10" />
            </Success>
            <Failure />
          </CheckConditionalAction>
          <AfflictionAction affliction="jailtime" strength="-1000" targettag="checkarrest" />
          <AfflictionAction affliction="bannedtime" strength="-1000" targettag="checkarrest" />
          <ClearTagAction tag="checkarrest" />
        </OnRoundEndAction>
      </ScriptedEvent>
      <!-- Event triggered from Jail Time affliction -->
      <ScriptedEvent identifier="release_from_jail">
        <!-- mark character for release -->
        <TagAction criteria="eventtag:statuseffecttarget" tag="releasecandidate" />
        <!-- remove jailtime and handcuffed affliction and add blackscreen affliction from and to the character that's being released -->
        <StatusEffectAction targettag="releasecandidate">
          <StatusEffect target="This" disabledeltatime="true" MultiplyByMaxVitality="true">
            <ReduceAffliction identifier="jailtime" amount="1000" />
            <ReduceAffliction identifier="handcuffed" amount="1000" />
            <ReduceAffliction identifier="handcuffedreinforced" amount="1000" />
            <Affliction identifier="blackscreen" amount="100" />
          </StatusEffect>
        </StatusEffectAction>
        <WaitAction time="0.5" />
        <!-- check for the equipped handcuffs and mark them for deletion -->
        <CheckItemAction targettag="releasecandidate" itemtags="handcuffs" ApplyTagToItem="removeitem">
          <Success>
            <!-- delete the equipped handcuffs -->
            <StatusEffectAction targettag="removeitem">
              <StatusEffect target="This" disabledeltatime="true">
                <Remove />
              </StatusEffect>
            </StatusEffectAction>
          </Success>
          <Failure />
        </CheckItemAction>
        <!-- teleport the character marked for release to the spawnpoint with the tag "hr" -->
        <TeleportAction position="Outpost" SpawnType="Human" SpawnPointTag="hr" targettag="releasecandidate" />
        <!-- play an uncuffing sound on the released character -->
        <StatusEffectAction targettag="releasecandidate">
          <StatusEffect target="This" disabledeltatime="true">
            <ReduceAffliction identifier="imprisonedjail" amount="1000" />
            <Affliction identifier="playsound_uncuff" amount="100" />
            <Affliction identifier="playsound_openjail" amount="100" />
            <Affliction identifier="blackscreen" amount="100" />
          </StatusEffect>
        </StatusEffectAction>
        <!-- clear the tag -->
        <ClearTagAction tag="releasecandidate" />
      </ScriptedEvent>
      <ScriptedEvent identifier="bail_for_release">
        <!-- tag everbody from the crew as "crewmember" -->
        <TagAction criteria="crew" tag="crewmember" />
        <!-- spawn a special npc that acts as the jail guard to talk to -->
        <SpawnAction npcsetidentifier="ih_npcs" npcidentifier="jailguard" lootingisstealing="true" targettag="jailguard" spawnlocation="Outpost" spawnpointtype="Human" teamid="FriendlyNPC" allowduplicates="false" targetmoduletags="AdminModule" />
        <!-- checkpoint -->
        <Label name="checkjailtime" />
        <!-- check all crewmembers if they have jailtime affliction and tag all of them with "hasjailtime" -->
        <CheckConditionalAction targettag="crewmember" applytagtotarget="hasjailtime">
          <Conditional jailtime="gt 10" />
          <Success>
            <!-- activate the converstaion with the jail guard NPC to allow bailing someone out -->
            <ConversationAction invokertag="bailer" speakertag="jailguard" waitforinteraction="true" text="eventtext.jailguard.ask" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1">
              <Option text="eventtext.jailguard.answer.yes">
                <!-- when selecting to bail someone out, check again if there is still someone to bail out as they might've already been released if some time has passed | this is to avoid having to pay 500mk with no one in jail to bail -->
                <CheckConditionalAction targettag="crewmember" applytagtotarget="hasjailtime">
                  <Conditional jailtime="gt 10" />
                  <Success>
                    <!-- check if the character has enough money on hand -->
                    <CheckMoneyAction targettag="bailer" amount="500">
                      <Success>
                        <!-- subtract the money from the character -->
                        <MoneyAction targettag="bailer" amount="-500" />
                        <ConversationAction targettag="bailer" speakertag="jailguard" waitforinteraction="false" text="eventtext.jailguard.answer.yes.success" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
                        <!-- choose a random person in jail to be released by adding the tag "bailthisone" to them -->
                        <TagAction criteria="eventtag:hasjailtime" tag="bailthisone" chooserandom="true" ContinueIfNoTargetsFound="false" />
                        <!-- set the affliction strength of jailtime for the character chosen to be released to 1 so the affliction triggers the "release_from_jail" event -->
                        <StatusEffectAction targettag="bailthisone">
                          <StatusEffect target="This" disabledeltatime="true" setvalue="true">
                            <Affliction identifier="jailtime" strength="1" />
                          </StatusEffect>
                          <!-- clear the "bailer" tag from characters and reset after 1 second -->
                          <ClearTagAction tag="bailer" />
                          <WaitAction time="1" />
                          <GoTo name="checkjailtime" />
                        </StatusEffectAction>
                      </Success>
                      <Failure>
                        <!-- tell the character they don't have enough money on hand -->
                        <ConversationAction targettag="bailer" speakertag="jailguard" waitforinteraction="false" text="eventtext.jailguard.answer.yes.insufficientfunds" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
                        <!-- clear the "bailer" tag from characters and reset after 1 second -->
                        <ClearTagAction tag="bailer" />
                        <WaitAction time="1" />
                        <GoTo name="checkjailtime" />
                      </Failure>
                    </CheckMoneyAction>
                  </Success>
                  <Failure>
                    <!-- tell the character that there's currently no one in jail -->
                    <ConversationAction targettag="bailer" speakertag="jailguard" waitforinteraction="false" text="eventtext.jailguard.answer.yes.failure" DialogType="Small" ignoreinterruptdistance="true" EventSprite="bombscare1" />
                  </Failure>
                </CheckConditionalAction>
                <!-- clear the "bailer" tag from characters and reset after 1 second -->
                <ClearTagAction tag="bailer" />
                <WaitAction time="1" />
                <GoTo name="checkjailtime" />
              </Option>
              <Option text="eventtext.jailguard.answer.no" endconversation="true">
                <GoTo name="checkjailtime" />
              </Option>
            </ConversationAction>
          </Success>
          <Failure>
            <WaitAction time="1" />
            <GoTo name="checkjailtime" />
          </Failure>
        </CheckConditionalAction>
      </ScriptedEvent>
    </EventPrefabs>
  </Randomevents>
</Override>